!function(i,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():i.Pull=t()}(this,function(){function i(i,t){var o=this;o.$element=_(i),o.touchesStart={},o.touchesDiff=0,o.isHorizontalScrolling=void 0,o.isTouch=!1,o.isMove=!1,o.isLoading=!1,o.isLockUp=!1,o.isLockDown=!1,o.isDone=!1,o.__timerFixSlideOutScreen=null,o.init(t)}function t(i){var t={};return t.start=g.start.replace("<%=text%>",i.opts.pullDownText.start),t.drop=g.drop.replace("<%=text%>",i.opts.pullDownText.drop),t.loading=g.loading.replace("<%=text%>",i.opts.pullDownText.loading),t.success=g.success.replace("<%=text%>",i.opts.pullDownText.success),t.failed=g.failed.replace("<%=text%>",i.opts.pullDownText.failed),t}function o(i){var t={};return t.start=v.start.replace("<%=text%>",i.opts.pullUpText.start),t.loading=v.loading.replace("<%=text%>",i.opts.pullUpText.loading),t.failed=v.failed.replace("<%=text%>",i.opts.pullUpText.failed),t.done=v.done.replace("<%=text%>",i.opts.pullUpText.done),t}function l(i,t){(t=i.pullUpTpls[t]?t:"start")!==i.pullUpDom.attr("data-state")&&i.pullUpDom.attr("data-state",t).html(i.pullUpTpls[t])}function n(i,t){(t=i.pullDownTpls[t]?t:"start")!==i.pullDownDom.attr("data-state")&&i.pullDownDom.attr("data-state",t).html(i.pullDownTpls[t])}function e(i){if(i.opts.autoLoad&&i.opts.onPullUp){var t=i.opts.scrollArea.scrollTop();i._scrollContentHeight-i.opts.threshold<=i._scrollAreaHeight+t&&i.triggerPullUp()}}function a(i){i.touches||(i.touches=i.originalEvent.touches)}function s(i,t){(t=t||this).isLoading||(t.opts.scrollArea.scrollTop()>0||t.isLoading||t.isLockUp?t.isTouch=!1:(t.isTouch=!0,t.isMove=!1,t.isHorizontalScrolling=void 0,t.touchesStart.x=i.touches[0].pageX,t.touchesStart.y=i.touches[0].pageY))}function p(i,t){if((t=t||this).isTouch){var o=i.touches[0].pageX,l=i.touches[0].pageY;if(void 0===t.isHorizontalScrolling&&(t.isHorizontalScrolling=!!(t.isHorizontalScrolling||Math.abs(l-t.touchesStart.y)<=Math.abs(o-t.touchesStart.x))),t.isHorizontalScrolling||t.isLockUp)t.isTouch=!1;else if(t.touchesDiff=l-t.touchesStart.y,clearTimeout(t.__timerFixSlideOutScreen),t.__timerFixSlideOutScreen=setTimeout(function(){t.$element.trigger("touchend").bind(t)},1e3),t.touchesDiff<0)t.isMove=!1;else{t.isMove=!0,i.preventDefault(),c(t.pullDownDom,0);var e=0;t.touchesDiff<=t.opts.distance?(e=t.touchesDiff,n(t,"start")):t.touchesDiff>t.opts.distance&&t.touchesDiff<=2*t.opts.distance?(e=t.opts.distance+.5*(t.touchesDiff-t.opts.distance),n(t,"drop")):e=t.opts.distance+.5*t.opts.distance+.2*(t.touchesDiff-2*t.opts.distance),t.pullDownDom.height(e)}}}function r(i){var i=i||this;if(clearTimeout(i.__timerFixSlideOutScreen),!i.isTouch||!i.isMove)return i.isTouch=!1,i.isMove=!1,void(i.isLoading||0===i.pullDownDom.height()||(c(i.pullDownDom,0),i.pullDownDom.height(0)));i.isTouch=!1,i.isMove=!1,c(i.pullDownDom,300),i.touchesDiff>i.opts.distance?i.triggerPullDown():i.pullDownDom.height(0)}function d(i){r(i)}function c(i,t){i.css({"-webkit-transition":"all "+t+"ms",transition:"all "+t+"ms"})}function u(i){var i=i||this;setTimeout(function(){c(i.pullDownDom,300),i.pullDownDom.height(0),setTimeout(function(){i.isLoading=!1,i.updateScrollContentHeight(),n(i,"start")},300)},500)}function b(i){0!==(i=i||this).pullDownDom.height()&&(c(i.pullDownDom,0),i.pullDownDom.height(0),n(i,"start"))}var _=window.Zepto||window.jQuery||_,h={$head:_("head"),$body:_("body"),$win:_(window)},f={text:'@-webkit-keyframes bb_animate-rotate{0%{-webkit-transform:rotate(0)}100%{-webkit-transform:rotate(360deg)}}@keyframes bb_animate-rotate{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@-webkit-keyframes bb_animate-load{0%{opacity:.2}100%{opacity:1}}@keyframes bb_animate-load{0%{opacity:.2}100%{opacity:1}}.bb_pull{text-align:center;display:box;display:-webkit-box;display:-moz-box;-webkit-box-pack:center;-moz-box-pack:center;-webkit-box-align:center;-moz-box-align:center}.bb_pull-inner *{margin:0;padding:0;-webkit-box-sizing:content-box;box-sizing:content-box}.bb_pull-inner{font:14px/1.42857143 "Lucida Grande",Verdana,"Microsoft YaHei",hei;-webkit-font-smoothing:antialiased;color:#333}.bb_pull-icon{display:inline-block;vertical-align:middle}.bb_pull-icon_loading{position:relative;width:10px;height:10px;border:2px solid #009def;border-right-color:transparent;border-radius:50%}.bb_pull-icon_loadFailed{position:relative;width:14px;height:14px}.bb_pull-icon_loadFailed:after,.bb_pull-icon_loadFailed:before{content:"";position:absolute;left:6px;top:0;width:2px;height:14px;background:#ee693b;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.bb_pull-icon_loadFailed:after{-webkit-transform:rotate(135deg);transform:rotate(135deg)}.bb_pull-icon_loadSuccess{display:inline-block;width:12px;height:6px;vertical-align:-3px;border:2px solid #13b418;border-width:0 0 2px 2px;-webkit-transform:translate(0,-5px) rotate(-45deg);transform:translate(0,-5px) rotate(-45deg)}.bb_pull-animate_rotate{-webkit-animation:bb_animate-rotate 1s linear 0s infinite;animation:bb_animate-rotate 1s linear 0s infinite}.bb_pull-icon_loading_ios{position:relative;width:24px;height:24px}.bb_pull-icon_loading_ios-line div{position:absolute;left:11px;top:0;width:2px;height:24px}.bb_pull-icon_loading_ios-line div:after,.bb_pull-icon_loading_ios-line div:before{content:"";display:block;height:30%;background:#777;border-radius:5px}.bb_pull-icon_loading_ios-line div:after{margin-top:10px}.bb_pull-icon_loading_ios-line div:nth-child(2){-webkit-transform:rotate(30deg);transform:rotate(30deg)}.bb_pull-icon_loading_ios-line div:nth-child(3){-webkit-transform:rotate(60deg);transform:rotate(60deg)}.bb_pull-icon_loading_ios-line div:nth-child(4){-webkit-transform:rotate(90deg);transform:rotate(90deg)}.bb_pull-icon_loading_ios-line div:nth-child(5){-webkit-transform:rotate(120deg);transform:rotate(120deg)}.bb_pull-icon_loading_ios-line div:nth-child(6){-webkit-transform:rotate(150deg);transform:rotate(150deg)}.bb_pull-icon_loading_ios-line div:nth-child(1):before{-webkit-animation:bb_animate-load 1.2s linear 0s infinite;animation:bb_animate-load 1.2s linear 0s infinite}.bb_pull-icon_loading_ios-line div:nth-child(2):before{-webkit-animation:bb_animate-load 1.2s linear .1s infinite;animation:bb_animate-load 1.2s linear .1s infinite}.bb_pull-icon_loading_ios-line div:nth-child(3):before{-webkit-animation:bb_animate-load 1.2s linear .2s infinite;animation:bb_animate-load 1.2s linear .2s infinite}.bb_pull-icon_loading_ios-line div:nth-child(4):before{-webkit-animation:bb_animate-load 1.2s linear .3s infinite;animation:bb_animate-load 1.2s linear .3s infinite}.bb_pull-icon_loading_ios-line div:nth-child(5):before{-webkit-animation:bb_animate-load 1.2s linear .4s infinite;animation:bb_animate-load 1.2s linear .4s infinite}.bb_pull-icon_loading_ios-line div:nth-child(6):before{-webkit-animation:bb_animate-load 1.2s linear .5s infinite;animation:bb_animate-load 1.2s linear .5s infinite}.bb_pull-icon_loading_ios-line div:nth-child(1):after{-webkit-animation:bb_animate-load 1.2s linear .6s infinite;animation:bb_animate-load 1.2s linear .6s infinite}.bb_pull-icon_loading_ios-line div:nth-child(2):after{-webkit-animation:bb_animate-load 1.2s linear .7s infinite;animation:bb_animate-load 1.2s linear .7s infinite}.bb_pull-icon_loading_ios-line div:nth-child(3):after{-webkit-animation:bb_animate-load 1.2s linear .8s infinite;animation:bb_animate-load 1.2s linear .8s infinite}.bb_pull-icon_loading_ios-line div:nth-child(4):after{-webkit-animation:bb_animate-load 1.2s linear .9s infinite;animation:bb_animate-load 1.2s linear .9s infinite}.bb_pull-icon_loading_ios-line div:nth-child(5):after{-webkit-animation:bb_animate-load 1.2s linear 1s infinite;animation:bb_animate-load 1.2s linear 1s infinite}.bb_pull-icon_loading_ios-line div:nth-child(6):after{-webkit-animation:bb_animate-load 1.2s linear 1.1s infinite;animation:bb_animate-load 1.2s linear 1.1s infinite}.bb_pull-inner{padding:5px}.bb_pull-up .bb_pull-inner{padding:10px}.bb_pull-icon_loading_ios{display:inline-block;vertical-align:middle;margin-right:-6px;-webkit-transform:scale(.75);transform:scale(.75)}.bb_pull-text{margin:0 5px;vertical-align:middle;color:#777}',id:"_bb_pull_style",isLoad:!1,load:function(){if(!this.isLoad){var i=_('<style id="'+this.id+'">'+this.text+"</style>");h.$head.append(i),this.isLoad=!0}},remove:function(){this.isLoad&&(_("#"+this.id).remove(),this.isLoad=!1)}},m=(window,{pullDownWrapper:'<div class="bb_pull bb_pull-down" style="height:0; overflow: hidden;"></div>',pullUpWrapper:'<div class="bb_pull bb_pull-up"></div>'}),g={start:'<div class="bb_pull-inner"><i class="bb_pull-icon bb_pull-icon_loading"></i><span class="bb_pull-text"><%=text%></span></div>',drop:'<div class="bb_pull-inner"><i class="bb_pull-icon bb_pull-icon_loading"></i><span class="bb_pull-text"><%=text%></span></div>',loading:'<div class="bb_pull-inner"><i class="bb_pull-icon bb_pull-icon_loading bb_pull-animate_rotate"></i><span class="bb_pull-text"><%=text%></span></div>',success:'<div class="bb_pull-inner"><i class="bb_pull-icon bb_pull-icon_loadSuccess"></i><span class="bb_pull-text"><%=text%></span></div>',failed:'<div class="bb_pull-inner"><i class="bb_pull-icon bb_pull-icon_loadFailed"></i><span class="bb_pull-text"><%=text%></span></div>'},v={start:'<div class="bb_pull-inner"><span class="bb_pull-text"><%=text%></span></div>',loading:'<div class="bb_pull-inner"><div class="bb_pull-icon"><div class="bb_pull-icon_loading_ios"><div class="bb_pull-icon_loading_ios-line"><div></div><div></div><div></div><div></div><div></div><div></div></div></div></div><span class="bb_pull-text"><%=text%></span></div>',failed:'<div class="bb_pull-inner"><span class="bb_pull-text"><%=text%></span></div>',done:'<div class="bb_pull-inner"><span class="bb_pull-text"><%=text%></span></div>'},w=0;return i.prototype.init=function(i){var c=this;if(c.__isInit)return c;if(w++,c.__isInit=!0,c.opts=_.extend(!0,{scrollArea:h.$win,lock:!1,distance:50,onPullDown:null,pullDownText:{start:"下拉刷新",drop:"释放刷新",loading:"刷新中...",success:"刷新成功",failed:"刷新失败"},onPullUp:null,autoLoad:!0,threshold:100,pullUpText:{start:"上拉加载更多",loading:"正在加载",failed:"加载失败，点击重试",done:"已全部加载"},pullDownDom:{},pullUpDom:{}},i),c.opts.scrollArea=_(c.opts.scrollArea),!c.opts.onPullDown&&!c.opts.onPullUp)throw"请设置 onPullDown 或 onPullUp 回调方法";if(f.load(),c.pullDownTpls=_.extend({},t(c),c.opts.pullDownDom),c.pullUpTpls=_.extend({},o(c),c.opts.pullUpDom),c.pullDownDom=_(m.pullDownWrapper),c.pullUpDom=_(m.pullUpWrapper),c.opts.lock&&c.lock(),c._scrollContentHeight=c.$element[0].scrollHeight,c._scrollAreaHeight=c.opts.scrollArea.height(),c.opts.onPullDown&&(n(c,"start"),c.$element.before(c.pullDownDom),c.$element.on("touchstart",function(i){a(i),s(i,c)}).on("touchmove",function(i){a(i),p(i,c)}).on("touchend",function(i){r(c)}).on("touchcancel",function(i){d(c)})),c.opts.onPullUp){l(c,"start"),c.$element.after(c.pullUpDom),e(c);var u=null;h.$win.on("resize",function(i){clearTimeout(u),u=setTimeout(function(){c.updateScrollAreaHeight()},150)}),c.opts.scrollArea.on("scroll",function(i){if(!(c.isLoading||c.isLockDown||c.isDone)){var t=c.opts.scrollArea.scrollTop(),o=c.pullUpDom.attr("data-state");c._scrollContentHeight-c.opts.threshold<=c._scrollAreaHeight+t&&c.opts.autoLoad&&"failed"!==o&&c.triggerPullUp()}}),c.pullUpDom.on("click",function(){var i=c.pullUpDom.attr("data-state");"done"!==i&&"loading"!==i&&("failed"!==i&&c.opts.autoLoad||c.triggerPullUp())})}},i.prototype.updateScrollContentHeight=function(){var i=this;i._scrollContentHeight=i.$element[0].scrollHeight,e(i)},i.prototype.updateScrollAreaHeight=function(){var i=this;i._scrollAreaHeight=i.opts.scrollArea.height(),e(i)},i.prototype.pullDownFailed=function(){var i=this;n(i,"failed"),u(i)},i.prototype.pullDownSuccess=function(){var i=this;n(i,"success"),u(i)},i.prototype.triggerPullDown=function(){var i=this;i.isLoading=!0,n(i,"loading"),i.pullDownDom.height(i.opts.distance),i.opts.onPullDown()},i.prototype.pullUpFailed=function(){var i=this;l(i,"failed"),i.isLoading=!1},i.prototype.pullUpSuccess=function(){var i=this;i.isLoading=!1,l(i,"start"),i.updateScrollContentHeight()},i.prototype.pullUpDone=function(){var i=this;i.isLoading=!1,i.isDone=!0,l(i,"done"),i.updateScrollContentHeight()},i.prototype.resetPullUpDone=function(){this.isDone=!1},i.prototype.triggerPullUp=function(){var i=this;i.isDone||i.isLockDown||i.isLoading||(i.isLoading=!0,l(i,"loading"),i.opts.onPullUp())},i.prototype.lock=function(i){var t=this;!i||"up"!==i&&"down"!==i?(t.isLockDown=!0,t.isLockUp=!0,l(t,"start"),b(t),t.pullDownDom.hide(),t.pullUpDom.hide()):"up"===i?(t.isLockUp=!0,b(t),t.pullDownDom.hide()):(t.isLockDown=!0,l(t,"start"),t.pullUpDom.hide())},i.prototype.unlock=function(i){var t=this;!i||"up"!==i&&"down"!==i?(t.isLockDown=!1,t.isLockUp=!1,t.pullDownDom.show(),t.pullUpDom.show(),t.updateScrollContentHeight()):"up"===i?(t.isLockUp=!1,t.pullDownDom.show()):(t.isLockDown=!1,t.pullUpDom.show(),t.updateScrollContentHeight())},i.prototype.destroy=function(){--w<=0&&f.remove(),self.lock(),self.pullDownDom&&self.pullDownDom.remove(),self.pullUpDom&&self.pullUpDom.remove()},i});