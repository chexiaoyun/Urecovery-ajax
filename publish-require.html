<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="msapplication-tap-highlight" content="no" />
		<meta http-equiv="x-ua-compatible" content="IE=edge" />
		<title>发布回收需求</title>
		<link rel="stylesheet" href="css/common.css" />
		<link rel="stylesheet" href="css/index.css" />
	</head>
	<style>
		.u-album-photo{
			margin-bottom:0;
		}
		.u-type-classify ul li img{
			display: none;
		}
		.jiathis_style_m{
			width:100%;
			height:2rem;
			background: #fff;
			position:fixed;
			bottom:0;
			left:0;
			padding:.2rem 0;
			display: none;
		}
		.jiathis_style_m a{
			width:.36rem;
			height:.32rem;
		}
	</style>
	<body>
		<div id="u-header" class="u-flex u-bgcolor">
			<div class="u-header-back u-flex" onclick="goback()"><i></i></div>
			<div class="u-header-center u-flex u-center">
				<span>发布回收需求</span>
			</div>
		</div>
		<div class="u-container">
			<form action="" id="u-publish">
				<div class="u-publish-wrapper">
					<div class="u-publish-type u-publish-click">
						<div class="u-type-wrapper u-flex">
							<div class="u-type-left u-flex u-resource-name"><input type="text" placeholder="选择再生资源类型" value="" id="" /></div>
							<div class="u-type-right u-flex"><i></i></div>
						</div>
					</div>
					<div class="u-publish-type">
						<div class="u-type-wrapper u-flex">
							<div class="u-type-left u-flex"><span>数量</span></div>
							<div class="u-type-right u-flex u-resource-num"><input type="number" value="100" class="u-flex"  /></div>
						</div>
					</div>
					<div class="u-publish-type">
						<div class="u-type-wrapper u-flex">
							<div class="u-type-left u-flex"><span>回收价（元）</span></div>
							<div class="u-type-right u-flex u-resource-price"><input type="number" value="" placeholder="300（参考价）" class="u-flex" /></div>
						</div>
					</div>
					<div class="u-apply-agree u-publish-agree u-flex">
						<div class="u-apply-select u-apply-dissent"></div>
						<p>要求回收商缴纳保证金</p>
					</div>
					<div class="u-publish-type">
						<div class="u-type-wrapper u-flex">
							<div class="u-type-left u-flex u-type-select"><span>所在地</span></div>
							<div class="u-type-right u-flex" id="sanji"></div>
						</div>
					</div>
					<div class="u-publish-type u-publish-address">
						<div class="u-type-wrapper u-flex u-type-address">
							<div class="u-type-left u-flex"><span>请在下面区域输入详细地址</span></div>
							<textarea name="" rows="" cols=""></textarea>
						</div>
					</div>
				</div>
				<div class="u-publish-show u-flex u-scolor u-center"><span>展开完善信息</span><img src="img/up.png" alt="" /></div>
				<div class="u-publish-more" style="display: none;">
					<div class="u-publish-type">
						<div class="u-type-wrapper u-flex">
							<div class="u-type-left u-flex"><span>品牌</span></div>
							<div class="u-type-right u-flex u-resource-brand"><input type="text" value="实达" class="u-flex" /></div>
						</div>
					</div>
					<div class="u-publish-bidding u-flex">
						<div class="u-bidding-date u-flex">竞拍时长（天）：</div>
						<div class="u-bidding-num u-flex">
							<img src="img/reduce.png" alt="" class="u-reduce" style="width:.51rem;height:.51rem" />
							<input type="number" value="1" />
							<img src="img/add.png" alt="" class="u-add" style="width:.58rem;height:.58rem;" />
						</div>
					</div>
					<div class="u-publish-bidding u-flex">
						<div class="u-bidding-date u-service-way u-flex">服务方式：</div>
						<ul class="u-publish-service u-flex u-resource-service">
							<li class='u-flex u-active'>
								<i></i>
								<span>上门回收</span>
							</li>
							<li class='u-flex'>
								<i></i>
								<span>物流快递</span>
							</li>
							<li class='u-flex'>
								<i></i>
								<span>协商交易点</span>
							</li>
						</ul>
					</div>
					<div class="u-publish-bidding u-flex">
						<div class="u-bidding-date u-service-way u-flex">交易模式：</div>
						<ul class="u-publish-service u-flex u-resource-deal">
							<li class='u-flex u-active'>
								<i></i>
								<span>以旧换新</span>
							</li>
							<li class='u-flex'>
								<i></i>
								<span>废旧处理</span>
							</li>
						</ul>
					</div>
					<div class="u-publish-textarea">
						<textarea name="" rows="" cols="" placeholder="输入您的留言（50字以下奖励2积分，50字以上获得
红包奖励）"></textarea>
					</div>
					<span class="u-flex u-publish-upd">图片上传：</span>
					<div class="u-clickload u-flex" id="btn">
						<div class="u-click u-flex">
							<img src="img/load.png" alt="" />
							<span>点击上传</span>
						</div>
						<div class="u-click-tip u-flex" style="flex-direction: row;">
							<i>*</i><span>详细描述50字以上，并上传5张有效照片，   可获得环保鼓励红包一个。</span>
						</div>
					</div>
					<input type="file" id="fileElem" multiple accept="image/*" name="myImage" onchange="handleFiles()" style="display:none;">
					<div class="album"></div>
				</div>
				<p class="u-gcolor u-publish-tip">* 以上信息为必填信息，点击展开完善信息将信息完善后提交，可获得红包奖励！</p>
				<div class="u-apply-agree u-publish-agree">
					<div class="u-apply-select u-apply-dissent"></div>
					<p>回收商报价后方可查看手机号码</p>
				</div>
				<div class="u-publish-btn u-flex u-center" onclick="hand()"><button class="u-btn u-bgcolor" type="button">提交发布</button></div>
				<!--选择类型-->
				<div class="u-type-mask" style="display: none;">
					<div class="u-type-classify">
						<h1>选择资源品类</h1>
						<ul>
							<li class="u-flex"><span></span><img src="img/bigon.png" alt="" /></li>
							<li class="u-flex"><span></span><img src="img/bigon.png" alt="" /></li>
							<li class="u-flex"><span></span><img src="img/bigon.png" alt="" /></li>
							<li class="u-flex"><span></span><img src="img/bigon.png" alt="" /></li>
							<li class="u-flex"><span></span><img src="img/bigon.png" alt="" /></li>
							<li class="u-flex"><span></span><img src="img/bigon.png" alt="" /></li>
							<li class="u-flex"><span></span><img src="img/bigon.png" alt="" /></li>
							<li class="u-flex"><span></span><img src="img/bigon.png" alt="" /></li>
							<li class="u-flex"><span></span><img src="img/bigon.png" alt="" /></li>
						</ul>
					</div>
				</div>
			</form>
		</div>
		<div class="u-red-mask" style="display: none;">
			<div class="u-red-wrapper u-flex">
				<span class="u-empty u-flex u-center">×</span>
				<div class="u-red-draw">
					<img src="img/packet.png" alt="" />
					<div class="u-red-now u-flex">
						<span>恭喜您<br/>获得2元红包</span>
						<i class="u-flex u-center">立即领取</i>
					</div>
				</div>
				<i>分享给好友领取更多惊喜喔！</i>
				<span class="u-red-enjoy u-flex u-center" id="share" onclick="share()">分享给好友</span>
			</div>
			<div class="jiathis_style_m"></div>
		</div>
		<script src="js/jquery-1.11.0.js"></script>
		<script src="js/common.js"></script>
		<script src="js/md5.js"></script>
		<script src="api.js"></script>
		<script id="bannerListTmp">
			function goback() {
				window.history.back();
			};
			//上传图片
			$('#btn').click(function(){
				$(this).next('input').click();
			});
			var imgarr=[];
			function handleFiles(){
				var oMyForm = new FormData();
        		oMyForm.append("image", $("#fileElem").get(0).files[0]);
				$.ajax({
		            url: apiurl+"/api/comm/upload",
		            type: "POST",
		            processData: false,
		            contentType: false,
		            data: oMyForm,
		            success: function (data) {
		            	imgarr.push(data.data);
		            	//console.log(imgarr);
		                if (data.falg= true) {
							var div=$('<div></div>');
							var imgone=$('<img class="imgone"src="" />');
							imgone.attr('src','img/remove.png');
							var img=$('<img class="img" src="" />');
							img.attr("src",apiurl+data.data);
							$('.album').append(div);
							div.append(imgone);
							div.append(img);
		                }
		            }
		        });
			};
			
			//分享好友
//			$('.u-red-mask .u-red-enjoy').click(function(){
////				alert(1)
//				$('.jiathis_style_m').show();
//				$('.jiathis_txt').hide();
//			});
			function share(param){
//				 window.js.plusReady(param);
			}
			
			//立即领取
			$('.u-red-now i').click(function(){
				$(this).text('已领取');
				$(this).addClass('u-active');
			});
			
			//提交发布

			function hand(){
				var province_id = $('#sheng').val();
			    var city_id = $('#shi').val();
			    var area_id = $('#qu').val();
			    //console.log(province_id,city_id,area_id);
				var name = $('.u-resource-name input').val();
				var span_id = $('.u-type-classify li.u-active span').attr("id");
				var name_id = $('.u-resource-name input').attr('id');
				name_id = span_id;
				var num = $('.u-resource-num input').val();
				var price = $('.u-resource-price input').val();
				var address = $(".u-type-address textarea").val();
				var brand = $('.u-resource-brand input').val();
				var valid_time = $('.u-bidding-num input').val();
				var province = $('#selProvince option').val();
				var type;
				var service = $('.u-resource-service li');
				for( var i=0;i<service.length;i++ ){
					if( service.eq(i).is('.u-active') ){
						type = i+1;
					}
				}
				var dealType;
				var deal = $('.u-resource-deal li');
				for( var i=0;i<deal.length;i++ ){
					if( deal.eq(i).is('.u-active') ){
						dealType = i+1;
					}
				}
				var note = $('.u-publish-textarea textarea').val();
				if( name == "" ){
					alert("请选择再生资源类型");
					return false;
				}
				if( num == "" ){
					alert("请输入回收数量");
					return false;
				}
				if( price == "" ){
					alert("请输入回收价");
					return false;
				}
				if( province_id == 0 && city_id == 0 && area_id == 0 && address == "" ){
					alert("请输入回收所在地和详细地址");
					return false;
				}
				var json = JSON.stringify(imgarr);   
				var paramOne = {photos:json};
				var paramTwo = {name_id:name_id,name:name,num:num,price:price,province_id:province_id,city_id:city_id,area_id:area_id,address:address,brand:brand,valid_time:valid_time,service:type,transaction:dealType,note:note};
				var param = Object.assign(paramOne,paramTwo,allparam);
				jsonAjax(
					"api/good/create",
					param,
					"json",
					function(data){
						if( data.flag = true ){
							alert(data.msg);
						}
					}
				);
			};
			//选择资源类型
			jsonAjax(
				"api/resources/index",
				"",
				"json",
				function(data){
					if( data.flag = true ){
						var li=$('.u-type-classify li');
						for(var i=0;i<li.length;i++){
							li.eq(i).find('span').text(data.data[i].name);
							li.eq(i).find('span').attr("id",data.data[i].id);
						}
					}
				}
			);
			//三级联动  省份
			var str="<select id='sheng'></select><select id='shi'></select><select id='qu'></select>";  //先写三个下拉列表放到div里面
			$("#sanji").html(str);
			  fullsheng();
			  fullshi();
			  fullqu();
			 
			  $("#sheng").change(function(){
			    fullshi();
			    fullqu();
			  })
			  $("#shi").change(function(){
			    fullqu();
			  })
			  //加载省份信息
			  function fullsheng()
			  {
			    var pcode="0";//根据父级代号查数据
			    $.ajax({
			      async:false, //采用异步的方式
			      url:apiurl+"api/area/findarea",
			      data:{area_id:pcode},
			      type:"POST",
			      dataType:"JSON",
			      success:function(data){
			        //这里传过来的data是个数组
			        str="";
			        for(var j in data.data)//js中的遍历数组用for来表示
			        {
			          str +="<option value='"+data.data[j].area_id+"'>"+data.data[j].area_name+"</option>";
			        }
			        $("#sheng").html(str);
			 
			      }
			 
			    })
			  }
			  //加载市的信息
			  function fullshi()
			  {
			    var pcode=$("#sheng").val();
			    $.ajax({
			      async:false,
			      url:apiurl+"api/area/findarea",
			      data:{area_id:pcode},
			      type:"POST",
			      dataType:"JSON",
			      success:function(data){
			        //这里传过来的data是个数组
			        str="";
			        for(var j in data.data)//js中的遍历数组用for来表示
			        {
			          str +="<option value='"+data.data[j].area_id+"'>"+data.data[j].area_name+"</option>";
			        }
			        $("#shi").html(str);
			 
			      }
			 
			    })
			  }
			  // 加载区的信息
			  function fullqu()
			  {
			    var pcode=$("#shi").val();
			    $.ajax({
			      url:apiurl+"api/area/findarea",
			      data:{area_id:pcode},
			      type:"POST",
			      dataType:"JSON",
			      success:function(data){
			        //这里传过来的data是个数组
			        str="";
			        for(var j in data.data)//js中的遍历数组用for来表示
			        {
			          str +="<option value='"+data.data[j].area_id+"'>"+data.data[j].area_name+"</option>";
			        }
			        $("#qu").html(str);
			 
			      }
			 
			    })
			  }
 
		</script>
	</body>

</html>